<section class="content-header">
  <div class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <div style="display: table-row;">
            <div style="display: table-cell; width: 41%;">
              <h1 class="m-0 text-dark" style="float: left">Dashboard</h1>
              <p style="line-height: 34px !important; display: inline;">&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;Periodo analisado:</p>
            </div>

            <div style="display: table-cell; width: 270px;">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="far fa-clock"></i></span>
                  <input type="text" class="form-control float-right" id="dashboard-range-picker">
                </div>
              </div>
            </div>

            <div style="display: table-cell">
              <div class="btn-group" style="vertical-align: baseline !important;">
                <button type="button" class="btn btn-info btn-block btn-flat" style="border-radius: 5px;">
                  <i class="fa fa-file-excel"></i>&nbsp;&nbsp;&nbsp;Baixar relatório
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><%= link_to 'Home', admin_root_path %></li>
            <li class="breadcrumb-item active">Dashboard</li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-3 col-6">
        <div class="small-box bg-info">
          <div class="inner">
            <h3><%= @total_visits %></h3>

            <p style="font-weight: bold;">└> Com base nas fichas criadas</p>
          </div>
          <div class="icon">
            <i class="ion ion-home"></i>
          </div>
          <p class="small-box-footer">Nº de visitas realizadas</p>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <div class="small-box bg-success">
          <div class="inner">
            <h3><%= @clean %></h3>

            <p style="font-weight: bold;">
              <%= @clean.positive? ? "└> #{(@clean * 100) / @total_visits}% dos locais visitados" : 'Número de visitas insuficientes para cálculo' %>
            </p>
          </div>
          <div class="icon">
            <i class="ion ion-thumbsup"></i>
          </div>
          <p class="small-box-footer">Locais visitados sem contaminação</p>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <div class="small-box bg-warning" style="color: #fff !important;">
          <div class="inner">
            <h3><%= @closed_or_refused %></h3>

            <p style="font-weight: bold;">
              <%= @closed_or_refused.positive? ? "└> #{(@closed_or_refused * 100) / @total_visits}% dos locais visitados" : 'Número de visitas insuficientes para cálculo' %>
            </p>
          </div>
          <div class="icon">
            <i class="ion ion-thumbsdown"></i>
          </div>
          <p class="small-box-footer" style="color: #fff !important;">Visitas negadas / Imóveis fechados</p>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <div class="small-box bg-danger">
          <div class="inner">
            <h3><%= @with_larvae %></h3>

            <p style="font-weight: bold;">
              <%= @with_larvae.positive? ? "└> #{(@with_larvae * 100) / @total_visits}% dos locais visitados" : 'Número de visitas insuficientes para cálculo' %>
            </p>
          </div>
          <div class="icon">
            <i class="ion ion-nuclear"></i>
          </div>
          <p class="small-box-footer">Imóveis com foco detectado</p>
        </div>
      </div>
    </div>

    <div class="row">
      <section class="col-lg-7 connectedSortable">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-chart-bar mr-1"></i>
              Distribuição das amostras
            </h3>

            <div class="card-tools">
              <ul class="nav nav-pills ml-auto">
                <li class="nav-item">
                  <a class="nav-link active" href="#species-by-region" data-toggle="tab">Qtd. de espécimes por região</a>
                </li>

                <li class="nav-item">
                  <a class="nav-link" href="#number-of-larvae-per-region" data-toggle="tab">Qtd. de larvas por região</a>
                </li>
              </ul>
            </div>
          </div>

          <div class="card-body">
            <div class="tab-content p-0">
              <div class="chart tab-pane active" id="species-by-region" style="position: relative; height: 300px;">
                <%= column_chart @species_by_region %>
              </div>

              <div class="chart tab-pane" id="number-of-larvae-per-region" style="position: relative; height: 300px;">
                <%= pie_chart @number_of_larvae_per_region %>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="col-lg-5 connectedSortable">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-chart-pie mr-1"></i>
              Locais de visita e coleta
            </h3>
            <div class="card-tools">
              <ul class="nav nav-pills ml-auto">
                <li class="nav-item">
                  <a class="nav-link active" href="#property-types" data-toggle="tab">Locais visitados</a>
                </li>

                <li class="nav-item">
                  <a class="nav-link" href="#contaminated-places" data-toggle="tab">Locais de coleta</a>
                </li>
              </ul>
            </div>
          </div>

          <div class="card-body">
            <div class="tab-content p-0">
              <div class="chart tab-pane active" id="property-types" style="position: relative; height: 300px;">
                <%= pie_chart @property_types %>
              </div>

              <div class="chart tab-pane" id="contaminated-places" style="position: relative; height: 300px;">
                <%= area_chart @contaminated_places %>
              </div>
            </div>
          </div>
        </div>

        <br />

        <%#= column_chart @xcontaminated_places %>
      </section>
    </div>
  </div>
</section>

<script>
    $(function() {
        $('#dashboard-range-picker').daterangepicker({
            "locale": {
                "format": "DD/MM/YYYY",
                "separator": " - ",
                "applyLabel": "Confirmar",
                "cancelLabel": "Cancelar",
                "fromLabel": "A partir de",
                "toLabel": "Até",
                "customRangeLabel": "Custom",
                "weekLabel": "S",
                "daysOfWeek": [
                    "Dom",
                    "Seg",
                    "Ter",
                    "Qua",
                    "Qui",
                    "Sex",
                    "Sab"
                ],
                "monthNames": [
                    "Janeiro",
                    "Fevereiro",
                    "Março",
                    "Abril",
                    "Maio",
                    "Junho",
                    "Julho",
                    "Agosto",
                    "Setembro",
                    "Outubro",
                    "Novembro",
                    "Dezembro"
                ],
                "firstDay": 1
            },
            "startDate": "<%= DateTime.now.beginning_of_month.strftime('%d/%m/%Y') %>",
            "endDate": "<%= DateTime.now.end_of_month.strftime('%d/%m/%Y') %>"
        }, function(start, end, label) {
            console.log('New date range selected: ' + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD') + ' (predefined range: ' + label + ')');
        });
    });
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
